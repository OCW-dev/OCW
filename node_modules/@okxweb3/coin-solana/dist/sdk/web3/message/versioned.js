"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.VersionedMessage = void 0;
const constants_1 = require("../transaction/constants");
const legacy_1 = require("./legacy");
const v0_1 = require("./v0");
exports.VersionedMessage = {
    deserializeMessageVersion(serializedMessage) {
        const prefix = serializedMessage[0];
        const maskedPrefix = prefix & constants_1.VERSION_PREFIX_MASK;
        if (maskedPrefix === prefix) {
            return 'legacy';
        }
        return maskedPrefix;
    },
    deserialize: (serializedMessage) => {
        const version = exports.VersionedMessage.deserializeMessageVersion(serializedMessage);
        if (version === 'legacy') {
            return legacy_1.Message.from(serializedMessage);
        }
        if (version === 0) {
            return v0_1.MessageV0.deserialize(serializedMessage);
        }
        else {
            throw new Error(`Transaction message version ${version} deserialization is not supported`);
        }
    },
};
//# sourceMappingURL=versioned.js.map